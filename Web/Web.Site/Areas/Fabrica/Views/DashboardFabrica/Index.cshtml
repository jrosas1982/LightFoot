@{
    ViewData["Title"] = "Dashboard Fabrica";
    Layout = "_Layout";

    var etapas = Model.AvanceProduccion.Select(x => x.Item1.Descripcion);
    var cantidad = Model.AvanceProduccion.Select(x => x.Item2);
}
@model DashboardFabricaModel

<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-lg-10">
        <h2>Bienvenido</h2>
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a href="@Url.Action("Index", "Dashboard", new { area = "fabrica" })">Home</a>
            </li>
        </ol>
    </div>
    <div class="col-lg-2">
    </div>
</div>

<div class="wrapper wrapper-content">

    <div id="tablaInfoGeneral">
        <partial name="_InfoGeneralSolicitudes.cshtml" model="null" />
    </div>

    <div class="row">
        <div class="col-xl-5">
            <div class="ibox">
                <div class="ibox-title">
                    <h5>Avance semanal de Produccion</h5>
                    <div class="ibox-tools">
                        <a class="collapse-link">
                            <i class="fa fa-chevron-up"></i>
                        </a>
                        <a class="close-link">
                            <i class="fa fa-times"></i>
                        </a>
                    </div>
                </div>
                <div class="ibox-content text-center">
                    <canvas id="pieChart"></canvas>
                </div>
            </div>
        </div>
        <div class="col-lg-7">
            <div id="tablaIRankingSucursales">
                <partial name="_RankingSucursalesTable.cshtml" model="null" />
            </div>
        </div>
    </div>


    <div class="row">
        <div class="col-xl-12">
            <div id="tablaInsumoStock">
                <partial name="_InsumoStockTable.cshtml" model="Model.InsumosBajoStock" />
            </div>
        </div>
    </div>



    @section Scripts {


        <environment names="Development">
            <script src="~/lib/flot/jquery.flot.js"></script>
            <script src="~/lib/flot/jquery.flot.tooltip.min.js"></script>
            <script src="~/lib/flot/jquery.flot.resize.js"></script>
            <script src="~/lib/flot/jquery.flot.pie.js"></script>
            <script src="~/lib/flot/jquery.flot.time.js"></script>
            <script src="~/lib/flot/jquery.flot.spline.js"></script>
            <script src="~/lib/sparkline/jquery.sparkline.min.js"></script>
            <script src="~/lib/chartJs/Chart.min.js"></script>
            <script src="~/lib/peity/jquery.peity.js"></script>

        </environment>
        <environment names="Staging,Production">
            <script src="~/lib/flot/jquery.flot.js"></script>
            <script src="~/lib/flot/jquery.flot.tooltip.min.js"></script>
            <script src="~/lib/flot/jquery.flot.resize.js"></script>
            <script src="~/lib/flot/jquery.flot.pie.js"></script>
            <script src="~/lib/flot/jquery.flot.time.js"></script>
            <script src="~/lib/flot/jquery.flot.spline.js"></script>
            <script src="~/lib/sparkline/jquery.sparkline.min.js"></script>
            <script src="~/lib/chartJs/Chart.min.js"></script>
            <script src="~/lib/peity/jquery.peity.min.js"></script>
        </environment>

        <script type="text/javascript">
            $(document).ready(function () {

                var etapas = JSON.parse('@Html.Raw(Json.Serialize(etapas))')
                var cantidad = JSON.parse('@Html.Raw(Json.Serialize(cantidad))')
                var colores = ['rgba(247, 184, 178, 1)', 'rgba(172, 185, 232, 1)', 'rgba(117, 185, 219, 1)', 'rgba(155, 211, 222, 1)', 'rgba(204, 153, 222, 1)', 'rgba(233, 223, 143, 1)', 'rgba(178, 236, 171, 1)'];

                var doughnutData = {
                    labels: etapas,
                    datasets: [{
                        data: cantidad,
                        backgroundColor: colores
                    }]
                };
                var doughnutOptions = {
                    responsive: true
                };
                var ctx4 = document.getElementById("pieChart").getContext("2d");
                new Chart(ctx4, { type: 'pie', data: doughnutData, options: doughnutOptions });


            });
        </script>

        <script type="text/javascript">
            //Aprtura de WebSockets
            Object.defineProperty(WebSocket, 'OPEN', { value: 1, });

            //conexion a SignalR
            var connection = new signalR.HubConnectionBuilder().withUrl("/NotificationsHub").build();
            connection.start();

            //Accion
            connection.on("FabricaDashboardUpdate", function () {
                Filtrar();
            });
        </script>
    }

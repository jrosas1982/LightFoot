@{
    ViewData["Title"] = "Cuenta Corriente";
    Layout = "_Layout";
}

@using Web.Site.Areas

@model IEnumerable<CuentaCorrienteModel>

<div class="row wrapper border-bottom white-bg page-heading navegacion">
    <div class="col-xl-8 col-lg-6">
        <h2>Cuenta Corriente</h2>
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a href="@Url.Action("Index", "Dashboard", new { area = "fabrica" })">Home</a>
            </li>
            <li class="breadcrumb-item">
                <a>Sucursal</a>
            </li>
            <li class="active breadcrumb-item">
                <strong>Cuenta Corriente</strong>
            </li>
        </ol>
    </div>
    <div class="col-xl-2 col-lg-3 mt-1 mt-sm-2 d-flex justify-content-end align-items-end p-lg-0" style="text-align:right">
        <button type="button" class="btn btn-w-m btn-default w-100" onclick="Reporte()">
            <span class="icon icon-xs"><span class="fas fa-file mr-2"></span></span>Reporte
        </button>
    </div>
    @*<div class="col-xl-2 col-lg-3 mt-1 mt-sm-2 d-flex justify-content-end align-items-end" style="text-align:right">
            <button type="button" class="btn btn-w-m btn-primary w-100"
                    onclick="location.href='@Url.Action("CrearEditar", "Usuario", 0)'">
                <span class="icon icon-xs"><span class="fas fa-plus mr-2"></span></span>Nuevo Usuario
            </button>
        </div>*@
</div>
<div class="d-none d-print-block w-100">
    <div class="alert alert-default" role="alert">
        Reporte de Cta Corriente @DateTime.Now
    </div>
</div>

<div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox ">
                <div class="ibox-title">
                    <h5>Cuenta Corriente Light Foot</h5>
                </div>
                <div class="ibox-content">
                    <div class="table-responsive">
                        <table class="footable table table-stripped table-hover table-bordered toggle-arrow-tiny" data-page-size="15">
                            <thead>
                                <tr>
                                    <th># Ciente</th>
                                    <th>Nombre </th>
                                    <th>Total Facturado</th>
                                    <th>Total Pagado</th>
                                    <th>Estado de Cuenta</th>
                                    <th data-sort-ignore="true" class="d-print-none">Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                @if (Model != null)
                                {
                                    foreach (var item in Model)
                                    {
                                        <tr>
                                            <td>@item.IdCliente</td>
                                            <td>@item.NombreCliente</td>
                                            <td>@item.TotalFacturado</td>
                                            <td>@item.TotalCobrado</td>
                                            <td>@item.DeudaTotal</td>
                                            <td class="d-print-none">
                                                <button class="btn btn-outline btn-warning  btn-xs" type="button" onclick="verDetalle('@item.IdCliente')" data-toggle="modal"
                                    data-target="#ModalDetalle">Ver Detalle</button>
                                            </td>
                                        </tr>
                                    }
                                }
                            </tbody>
                            <tfoot class="d-print-none">
                                <tr>
                                    <td colspan="12">
                                        <ul class="pagination float-right"></ul>
                                    </td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
@*MODAL detalle*@

<div class="modal inmodal fade" id="ModalDetalle" tabindex="-1" role="dialog" style="display: none;" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header pb-1">
                <div class="row">
                    <div class="col-sm-12 d-flex justify-content-center">
                        <h1 style="font-size:30px;">Detalle Cuenta Corriente</h1>
                    </div>
                </div>
            </div>
     
        <div class="modal-body py-2">
            <div id="partialViewEventos">
                <partial name="_ComprasClienteDetalle.cshtml" model="null" />
            </div>
            <div id="partialViewModalDetalle">
                <partial name="_PagosClienteDetalle.cshtml" model="null" />
            </div>
        </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-white" data-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>

@section Styles {

}

@section Scripts {

    <script type="text/javascript">
        function verDetalle(id) {
            ActualizarDetalleCompra(id);
            $.ajax({
                type: "Get",
                url: "/sucursal/CuentaCorriente/CargarPagosRecibidos",
                traditional: true,
                data: {
                    IdCliente: id
                },
                contentType: "application/json",
                success: function (response) {
                    $("#partialViewModalDetalle").html(""); //clear the records content
                    $("#partialViewModalDetalle").html(response);  //add the updated content.
                    $('.footable').footable();
                    $('.footable').trigger('footable_redraw');
                    //$('#ModalrecibirCompra').modal('hide');
                },
                error: function () {
                    swal("Error", "Intente más tarde", "error");
                }
            });
        }

        function ActualizarDetalleCompra(id) {
            $.ajax({
                type: "Get",
                url: "/sucursal/CuentaCorriente/CargarComprasCliente?IdCliente=" + id,
                traditional: true,
                data: {
                    IdCliente: id
                },
                contentType: "application/json",
                success: function (response) {
                    $("#partialViewEventos").html(""); //clear the records content
                    $("#partialViewEventos").html(response);  //add the updated content.
                    $('.footable').footable();
                    $('.footable').trigger('footable_redraw');
                },
                error: function () {
                    swal("Error", "Intente más tarde", "error");
                }
            });
        }
    </script>
}
